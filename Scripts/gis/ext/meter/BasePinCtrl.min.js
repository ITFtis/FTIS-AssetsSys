$.AppConfigOptions&&$.AppConfigOptions.script&&$.AppConfigOptions.script.gispath||alert("尚未設定(BasePinCtrl)$.AppConfigOptions.script.gispath"),function(n){"use strict";n.BasePinCtrl={defaultSettings:{name:"XXXX",stTitle:function(){return"XXXX"},map:undefined,useLabel:!0,pinLabel:!0,useList:!0,useExport:undefined,listContainer:".popu-ctrl-container",listTheme:"meter",listOptions:{},useCardview:!0,defalutCardview:!1,useSearch:!0,enabledStatusFilter:!1,minZoom:0,maxZoom:19,clickable:!0,pinClick:undefined,autoReload:{auto:!1,interval:3e5},pinsize:{x:12,y:12,minx:8,maxx:32,miny:10,maxy:32,step:4,anchor:"cneter"},geometryOtherOptions:{},dynPinsize:!0,legendIcons:[],infoFields:[],layerid:undefined,pinInfoLabelMinWidth:undefined,boundary:undefined,filter:undefined,infoWindowAnimation:!0,useInfoWindow:!0,canFullInfowindow:!1,singleInfoWindow:!0,cluster:!1,clusterRadius:80,clusterDisableAtZoom:20,pinInfoContent:function(t){var r=this.settings,u=r.infoFields,i="";return i="<table>",n.each(u,function(n,u){try{u.showInInfo!==!1&&(i+="<tr><td "+(r.pinInfoLabelMinWidth?'style="min-width: '+r.pinInfoLabelMinWidth+';"':"")+"><span  ><b>"+u.title+"<\/b><\/span><\/td><td><span>"+(u.formatter?u.formatter(t[u.field.trim()],t,"InfoWindow"):t[u.field])+(u.unit?" "+u.unit:"")+"<\/span><\/td><\/tr>")}catch(f){console.log(u.title+"pinInfoContent錯誤:"+f)}}),i+="<\/table>",'<div class="meterInfoTemplateContent '+this.$element.attr("id")+"-info-content "+this.settings.name+'-info-content">'+i+"<\/div>"},checkDataStatus:function(){return{classes:"blue_status"}},appendCustomToolbarHeader:undefined,type:"point"},eventKeys:{displayLayer:"~~displayLayer",displayList:"~~displayList",initLayer:"~~initLayer",initUICompleted:"~initUiCompleted",repaintPinCompleted:"~repaintPinCompleted",pinShowChange:"~pinshowchange",fullInfowindowChange:"~fullInfowindowChange"},type:{point:"point",polygon:"polygon",polyline:"polyline",feature:'"Feature"'},helper:{getDataStatusLegendIcon:function(t,i){var r=undefined;return i?(n.each(t,function(){if(this.name.trim()===i.trim())return r=this,!1}),r||console.log('無對應圖例name:"'+i+'"'),r):r},ajaxDotnetWebserviceEmptyParas:function(t,i){var r=this;n.BasePinCtrl.helper.ajaxGeneralRequest.call(this,{url:t,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST"},function(n){i.call(r,n.d)})},ajaxDotnetWebserviceWithParasAsync:function(t,i){var r,u=typeof i=="string"?i:JSON.stringify(i);return n.ajax({url:t,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:u,"async":!1}).done(function(n){n&&n.d&&(r=n.d)}).fail(function(n){console.log(n.responseText)}),r},ajaxDotnetWebserviceWithParas:function(t,i,r){var u,f=typeof i=="string"?i:JSON.stringify(i);n.ajax({url:t,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:f}).done(function(n,t){n&&n.d&&(u=n.d);r(u,t)}).fail(function(n,t){console.log(n.responseText);r(n,t)})},ajaxGeneralRequest:function(t,i){var r=this;n.ajax(t).done(function(n){i&&i.call(r,n)}).fail(function(n){console.log(n)})},getWraMeterData:function(t,i,r,u,f){n.ajax({url:(window.WraMeterSource?window.WraMeterSource:"//fhy.wra.gov.tw/Typh_New/Meter.asmx/")+t,dataType:"text",dataFilter:function(t){var o,i,e,f;if(t=t.replace(/\r\n/g,""),o=helper.format.xmlToJson.parseString(t),i=o,r)for(e=r.split("."),f=0;f<e.length;f++)i=i[e[f]];return i=n.isArray(i)?i:[i],helper.format.xmlToJson.setXmlObjTextToValue(i,u)},data:i,type:"POST"}).done(function(n){f(n)}).fail(function(n,t){console.log(JSON.stringify(n)+"<br>"+JSON.stringify(t))})},getWraFhyApi:function(t,i,r){var u=n.extend({url:"//fhy.wra.gov.tw/Api/v2/"+t,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"},i);n.ajax(u).done(function(n){r(n)}).fail(function(n,t){r(n,t)})},reload:function(t){this.$element.show_busyIndicator({timeout:4e4});this.__baseData||(this.settings.loadBase===undefined?console.log(this.settings.name+" 無設定取基本資料"):typeof this.settings.loadBase=="string"?n.BasePinCtrl.helper.ajaxDotnetWebserviceEmptyParas.call(this,this.settings.loadBase,this.__loadBaseCompleted):typeof this.settings.loadBase=="function"?this.settings.loadBase.call(this,jQuery.proxy(this.__loadBaseCompleted,this)):typeof this.settings.loadBase=="object"&&n.BasePinCtrl.helper.ajaxGeneralRequest.call(this,this.settings.loadBase,this.__loadBaseCompleted));this.settings.loadInfo===undefined?console.log(this.settings.name+" 無設定取即時資料"):typeof this.settings.loadInfo=="string"?n.BasePinCtrl.helper.ajaxDotnetWebserviceEmptyParas.call(this,this.settings.loadInfo,this.__loadInfoCompleted):typeof this.settings.loadInfo=="function"?this.settings.loadInfo.call(this,t,jQuery.proxy(this.__loadInfoCompleted,this)):typeof this.settings.loadInfo=="object"&&n.BasePinCtrl.helper.ajaxGeneralRequest.call(this,this.settings.loadInfo,this.__loadInfoCompleted)}},pinIcons:{water:{normal:{name:"正常",url:n.AppConfigOptions.script.gispath+"/images/meter/水位站-g.png",classes:"water_normal"},warnLevel3:{name:"三級",url:n.AppConfigOptions.script.gispath+"/images/meter/水位站-y.png",classes:"water_warnleve3"},warnLevel2:{name:"二級",url:n.AppConfigOptions.script.gispath+"/images/meter/水位站-o.png",classes:"water_warnleve2"},warnLevel1:{name:"一級",url:n.AppConfigOptions.script.gispath+"/images/meter/水位站-r.png",classes:"water_warnleve1"},noData:{name:"無資料",url:n.AppConfigOptions.script.gispath+"/images/meter/水位站-gr.png",classes:"water_nodata"}},rain:{normal:{name:"正常",url:n.AppConfigOptions.script.gispath+"/images/meter/雨量站-正常.png",classes:"rain_normal"},heavy:{name:"大雨",url:n.AppConfigOptions.script.gispath+"/images/meter/雨量站-大雨.png",classes:"rain_heavy"},extremely:{name:"豪雨",url:n.AppConfigOptions.script.gispath+"/images/meter/雨量站-豪雨.png",classes:"rain_extremely"},torrential:{name:"大豪雨",url:n.AppConfigOptions.script.gispath+"/images/meter/雨量站-大豪雨.png",classes:"rain_torrential"},extremely_torrential:{name:"超大豪雨",url:n.AppConfigOptions.script.gispath+"/images/meter/雨量站-超大豪雨.png",classes:"rain_exttorrential"},noData:{name:"無資料",url:n.AppConfigOptions.script.gispath+"/images/meter/雨量站-無資料.png",classes:"rain_nodata"}},cctv:{normal:{name:"攝影機",url:n.AppConfigOptions.script.gispath+"/images/camera.png",classes:"blue_status"}},defaultPin:{name:"圖例",url:n.AppConfigOptions.script.gispath+"/images/blue-pushpin.png",classes:"blue_status"}}};var t="BasePinCtrl",i=function(t,i){i&&(i.stopPropagation(),i.preventDefault());this.$element=n(t);this.$__pinswitch=undefined;this.$__pinlabel=undefined;this.$__pinlist=undefined;this.settings=n.extend({},n.BasePinCtrl.defaultSettings);this.$___listJspanelElement=undefined;this.__triggerMouseEventForListTable=!0;this.___datas=undefined;this.___displaydatas=[];this.___customfilter="";this.___queryfilter="";this.isInitCompleted=!1;this.visible=!1;this._mainctrl=undefined};i.prototype={constructor:i,init:function(t){var r=n.extend({},this.settings.pinsize),i;if(n.extend(this.settings,t),this.settings.pinsize=n.extend(r,t.pinsize),this.___customfilter=this.settings.filter,this.settings.useExport=this.settings.useExportCsv||this.settings.useExport||!1,this.settings.autoReload===!0&&(this.settings.autoReload={auto:!0,interval:3e5}),i=this,this.settings.initEvent)this.$element.on(this.settings.initEvent,function(){i.isInitCompleted||i.initMap()});else this.initMap();this.$element.addClass(this.settings.name?"pin-"+this.settings.name:"")},initMap:function(){var t=this;whatMap(this.settings.map)==="google"?this.settings.type==n.BasePinCtrl.type.polygon?helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/GPolygonBasePinCtrl.js"],function(){t._mapctrl=new GPolygonBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==n.BasePinCtrl.type.polyline?window.GPolylineBasePinCtrl?t._mapctrl=new GPolylineBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/GPolylineBasePinCtrl.js"],function(){t._mapctrl=new GPolylineBasePinCtrl(t,function(){t.initUI()})}):window.GBasePinCtrl?t._mapctrl=new GBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/GBasePinCtrl.js"],function(){t._mapctrl=new GBasePinCtrl(t,function(){t.initUI()})}):whatMap(this.settings.map)==="leaflet"?this.settings.type==n.BasePinCtrl.type.feature?window.LFeatureBasePinCtrl?t._mapctrl=new LFeatureBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/LFeatureBasePinCtrl.js"],function(){t._mapctrl=new LFeatureBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==n.BasePinCtrl.type.polygon?window.LPolygonBasePinCtrl?t._mapctrl=new LPolygonBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/LPolygonBasePinCtrl.js"],function(){t._mapctrl=new LPolygonBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==n.BasePinCtrl.type.polyline?window.LPolylineBasePinCtrl?t._mapctrl=new LPolylineBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/LPolylineBasePinCtrl.js"],function(){t._mapctrl=new LPolylineBasePinCtrl(t,function(){t.initUI()})}):window.LBasePinCtrl?t._mapctrl=new LBasePinCtrl(t,function(){t.initUI()}):n.getScript(n.AppConfigOptions.script.gispath+"/ext/meter/LBasePinCtrl.js",function(){t._mapctrl=new LBasePinCtrl(t,function(){t.initUI()})}):whatMap(this.settings.map)==="golife"?window.GLBasePinCtrl?t._mapctrl=new GLBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/GLBasePinCtrl.js"],function(){t._mapctrl=new GLBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==n.BasePinCtrl.type.polygon?window.APolygonBasePinCtrl?t._mapctrl=new APolygonBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/APolygonBasePinCtrl.js"],function(){t._mapctrl=new APolygonBasePinCtrl(t,function(){t.initUI()})}):this.settings.type==n.BasePinCtrl.type.polyline?window.APolylineBasePinCtrl?t._mapctrl=new APolylineBasePinCtrl(t,function(){t.initUI()}):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/ext/meter/APolylineBasePinCtrl.js"],function(){t._mapctrl=new APolylineBasePinCtrl(t,function(){t.initUI()})}):window.ABasePinCtrl?t._mapctrl=new ABasePinCtrl(t,function(){t.initUI()}):n.getScript(n.AppConfigOptions.script.gispath+"/ext/meter/ABasePinCtrl.js",function(){t._mapctrl=new ABasePinCtrl(t,function(){t.initUI()})})},__checkCtrlEnableForZoomLevel:function(n){var t=this,i=t.$__pinswitch.is(":checked");(t.settings.minZoom!=0||t.settings.maxZoom!=19)&&(n<t.settings.minZoom||n>t.settings.maxZoom?(t.$__pinswitch.attr("disabled",!0),t.$__pinlabel.attr("disabled",!0),t.$__pinlist.attr("disabled",!0),t.$___listJspanelElement&&t.$___listJspanelElement.is(":visible")&&t.$___listJspanelElement.hide()):(t.$__pinswitch.attr("disabled",!1),t.$__pinlabel.attr("disabled",!i),t.$__pinlist.attr("disabled",!i),t.$___listJspanelElement&&t.$__pinlist.is(":checked")&&t.$__pinlist.trigger("change")),i&&(t.show(),t.$__pinlabel.trigger("change")))},initUI:function(){var t=this,u,i,f,r;setTimeout(function(){t.settings.pinClick!=null&&(t._mapctrl.pinClick=t.settings.pinClick);t._mapctrl.onFocusRowIndex=function(i){var r,f,u;t.$___listJspanelElement&&(r=n(".fixed-table-body tbody tr[data-index="+i+"]:eq(0)",t.$___listJspanelElement.$listBootstrapTable),r&&r.length>0&&(f=r.height(),u=!t.$___listJspanelElement.$listBootstrapTable.find(".fixed-table-header>table>thead:eq(0)").is(":visible"),t.___scrollContenTop.call(t,r[0].offsetTop-(u?20:60)),r.addClass("meter-active")))};t._mapctrl.offFocusRowIndex=function(){if(t.$___listJspanelElement)var i=n(".fixed-table-body tbody tr[data-index]",t.$___listJspanelElement.$listBootstrapTable).removeClass("meter-active")};t._mapctrl.onMapZoomEnd=function(n){t.__checkCtrlEnableForZoomLevel(n)};t.__checkCtrlEnableForZoomLevel(t._mapctrl.getCurrentZoomlevel())});u=!this.settings.useLabel&&!this.settings.useList?12:6;i='<div class="col-xs-12 col-12 ctrl"><label class="col-xs-'+u+" col-"+u+'"><input type="checkbox" class="pinswitch"><span class="checkbox-glyphicon base-background  btn-sm  glyphicon "><\/span><span class="checkbox-name">'+this.settings.name+"<\/span><\/label>";this.settings.useLabel&&(i+='<label class="col-xs-3 col-3"><input type="checkbox" disabled class="pinlabel"><span class="checkbox-glyphicon base-background  btn-sm glyphicon"><\/span><span class="checkbox-name">標籤<\/span><\/label>');this.settings.useList&&(i+='<label class="col-xs-3 col-3"><input type="checkbox" disabled class="pinlist"><span class="checkbox-glyphicon base-background  btn-sm glyphicon"><\/span><span class="checkbox-name">清單<\/span><\/label>');i+="<\/div>";this.$element.addClass("pinctrl");this.$element.append(i);this.repaintLegendUI();this.$__pinswitch=n("input.pinswitch",this.$element);this.$__pinlabel=n("input.pinlabel",this.$element);this.$__pinlist=n("input.pinlist",this.$element);this.$__pinswitch.on("change",function(){var i=n(this).is(":checked"),e=t.$__pinlist.is(":checked"),u;(i?(t.visible=!0,t._mapctrl.visible=!0):(t.visible=!1,t._mapctrl.visible=!1),n("input.pinlabel",t.$element).attr("disabled",!i),n("input.pinlist",t.$element).attr("disabled",!i),t.settings.map)&&(t.isInitCompleted||(t.$element.show_busyIndicator({timeout:2e4}),t.___datas&&t.setData(t.___datas),t.$element.trigger(n.BasePinCtrl.eventKeys.initLayer,!0)),i?t.show():t.hide(),t.isInitCompleted=!0,t.$element.trigger(n.BasePinCtrl.eventKeys.displayLayer,i),u=function(){(new Date).getTime()-r>=t.settings.autoReload.interval&&(t.$element.trigger(n.BasePinCtrl.eventKeys.initLayer,!0),r=(new Date).getTime());f=setTimeout(u,t.settings.autoReload.interval)},t.settings.autoReload.auto&&(t.visible?(r||(r=(new Date).getTime()),u()):clearTimeout(f)))});this.$__pinlabel.on("change",function(){var n=t.isShowLabel(),i=t.$__pinlabel.is(":disabled");t._mapctrl.showLabel(n&&!i)});this.$__pinlist.on("change",function(){var f=n(this).is(":checked"),e=(new Date).getTime(),r,i,u;if(f&&!t.$___listJspanelElement){r=[];t.settings.useSearch&&r.push({item:'<span class="glyphicon glyphicon-search" title="搜尋"><\/span>',event:"click",callback:function(){var i=n(this).val();n(".fixed-table-toolbar .search",t.$___listJspanelElement.$listBootstrapTable).toggleClass("active").toggle("blind");t.___scrollContenTop.call(t,0);setTimeout(function(){t.___resizeTable()},300)}});t.settings.useCardview&&r.push({item:'<span class="glyphicon glyphicon-list-alt icon-list-alt" title="檢視切換"><\/span>',event:"click",callback:function(){t.___displaydatas.length>200&&t.$___listJspanelElement.show_busyIndicator();setTimeout(function(){var i=n("button[name=toggle]",t.$___listJspanelElement);i.trigger("click");setTimeout(function(){n(".fixed-table-header",this.$___listJspanelElement).css("border-bottom-color","").css("border-bottom-width","");t.$___listJspanelElement.hide_busyIndicator()},100)},10)}});t.settings.useExport&&r.push({item:'<span class="glyphicon glyphicon-floppy-save " title="下載"><\/span>',event:"click",callback:function(){t.settings.useExport==!0?helper.misc.tableToExcel(t.$___listJspanelElement.$table,[t.settings.name],t.settings.name):typeof t.settings.useExport=="object"?(t.settings.useExport.filename=t.settings.useExport.filename||t.settings.name,t.settings.useExport.sheetname=t.settings.useExport.sheetname||t.settings.name,helper.misc.tableToExcel(t.$___listJspanelElement.$table,[t.settings.useExport.sheetname],t.settings.useExport.filename,t.settings.useExport.csv)):typeof t.settings.useExport=="function"&&t.settings.useExport(t.$___listJspanelElement.$table)}});t.settings.appendCustomToolbarHeader&&n.each(t.settings.appendCustomToolbarHeader,function(){r.push(this)});r.push({item:'<span class="meter-list-count"><\/span>'});i=t.___getLocalCache()||{};i.top&&window.outerHeight-i.top<70&&(i.top=window.outerHeight-70);i.left&&window.outerWidth-i.left<200&&(i.left=window.outerWidth-200);t.pinctrlid===undefined&&(t.pinctrlid=t.settings.layerid+"_"+(new Date).getTime());t.$___listJspanelElement=n(t.settings.listContainer).jsPanel({id:"jsp_"+t.pinctrlid+"",title:t.settings.name,theme:t.settings.listTheme,classes:"pin-list-container pin-list-container-"+t.settings.name,size:{width:i.width?i.width:"250",height:i.height?i.height:"300"},overflow:"auto",draggable:{stop:function(t){n(t.target).css("opacity","")}},position:{top:i.top?i.top+"px":"60px",left:i.left?i.left+"px":"center"},controls:{buttons:"closeonly",iconfont:"bootstrap"},content:'<table id="metertable_'+t.pinctrlid+'" class="col-xs-12 col-12"><\/table>',toolbarHeader:r}).mouseenter(function(){t.$___listJspanelElement.front()}).on("resizestop",function(){t.___setLocalCache({width:t.$___listJspanelElement.width(),height:t.$___listJspanelElement.height()});t.___resizeTable()}).on("dragstop",function(){t.___setLocalCache({top:t.$___listJspanelElement.position().top,left:t.$___listJspanelElement.position().left})}).on("onjspanelloaded",function(){var t=n(this);t.position().left<0&&t.css("left",0);t.position().top<0&&t.css("top",0)});t.$___meterListCount=n(".meter-list-count",t.$___listJspanelElement);n(".jsPanel-hdr-r .jsPanel-hdr-r-btn-close",t.$___listJspanelElement).unbind("click").on("click",function(){n("input.pinlist",t.$element).prop("checked",!1).trigger("change")});u=function(){var r=n(".fixed-table-toolbar .search input",t.$___listJspanelElement.$listBootstrapTable),i=0;setTimeout(function(){r.off("keyup drop blur").on("keyup drop blur",function(r){clearTimeout(i);i=setTimeout(n.proxy(t.setFilter,t,t.___customfilter,n(r.currentTarget).val()),t.___datas.length*1.5)})},1e3)};t.$element.show_busyIndicator();n("").bootstrapTable?t._initListTable(u):helper.misc.getJavaScripts([n.AppConfigOptions.script.gispath+"/bootstraptable/bootstrap-table.js"],function(){t._initListTable(u)});setTimeout(function(){t.$___listJspanelElement.front()},100);t.$___listJspanelElement.mouseenter(function(){t.$___listJspanelElement.front()})}f?(t.$___listJspanelElement.show(),t.___resizeTable()):t.$___listJspanelElement&&t.$___listJspanelElement.hide()});this.$element.trigger(n.BasePinCtrl.eventKeys.initUICompleted)},_initListTable:function(t){var i=this,r;n.each(i.settings.infoFields,function(){this.visible=this.showInList});r=n.extend({height:200,striped:!1,search:!0,showToggle:!0,cardView:i.settings.defalutCardview,columns:i.settings.infoFields,data:i.___displaydatas?i.___displaydatas:[],rowStyle:n.proxy(i.settings.checkDataStatus,i),onClickRow:function(n){i.__triggerMouseEventForListTable&&i.settings.useInfoWindow&&i._mapctrl.showInfoWindow(i._mapctrl.getGraphicByRindex(n.rindex),!0)},onSort:function(){return setTimeout(function(){var t=i.$___listJspanelElement.$table.bootstrapTable("getData");n.each(t,function(n){this.rindex=n})},10),!1},formatNoMatches:function(){return"無資料!!"},formatSearch:function(){return"搜尋"},onPostBody:function(){i.___listenTableMouseEvent()}},i.settings.listOptions);i.$___listJspanelElement.$table=n("#metertable_"+i.pinctrlid).bootstrapTable(r);i.$___listJspanelElement.$listBootstrapTable=i.$___listJspanelElement.$table.parents(".bootstrap-table").first().addClass("metertable");i.___resizeTable();i.$element.hide_busyIndicator();t&&t()},setFocusPoint:function(t,i){var r=this;n.each(r.___displaydatas,function(){if(this[i]===t[i]||this[i]===t)return r.settings.useInfoWindow&&r._mapctrl.showInfoWindow(r._mapctrl.getGraphicByRindex(this.rindex),!0),!1})},removeFocusPoint:function(t,i){var r=this;t&&i!==undefined?n.each(r.___displaydatas,function(){if(this[i]===t[i])return r.settings.useInfoWindow&&r._mapctrl.closeInfoWindow(r._mapctrl.getGraphicByRindex(this.rindex)),!1}):r._mapctrl.closeInfoWindow()},setBoundary:function(n){this.settings.boundary=n;this.setFilter(this.___customfilter,this.___queryfilter,!0)},fitBounds:function(){this._mapctrl.fitBounds&&this._mapctrl.fitBounds()},setFilter:function(t,i,r){var u=this,f;(i===undefined&&(i=this.___queryfilter),typeof i=="boolean"&&(r=i,i=this.___queryfilter),r||t!==this.___customfilter||i!==this.___queryfilter)&&(this.___queryfilter=i,this.___customfilter=t,typeof t!="function"&&t&&(t=t.toLowerCase()),i&&(i=i.toLowerCase()),this.___displaydatas=[],this.___datas&&this.___datas.length>0&&(f=undefined,this.settings.enabledStatusFilter&&(f=n.map(this.$element.find(".legend-disable"),function(t){return n(t).text()})),this.___displaydatas=n.grep(this.___datas,function(r){var e,o;return f&&f.length>0&&(e=u.settings.checkDataStatus.call(u,r),e!=null&&f.indexOf(n("<div>"+e.name+"<\/div>").text())>=0)?!1:u.settings.boundary&&(o=helper.gis.pointInPolygon([r.X,r.Y],u.settings.boundary),!o)?!1:typeof t=="function"?t(r)&&u.___filterItemText(r,i):u.___filterItemText(r,t)&&u.___filterItemText(r,i)})),this.___repaint())},setData:function(t){var i=this;this.___datas=t;t&&t.length>0&&this.settings.infoFields.length==0&&n.each(t[0],function(n){i.settings.infoFields.push({field:n,title:n})});this.setFilter(this.___customfilter,this.___queryfilter,!0)},add:function(n){if(this._mapctrl){var t=this;if(this.___datas=this.___datas||[],this.___datas.push(n),t.___displaydatas.push(n),!this._mapctrl.add){alert("this._mapctrl尚未實作add");return}this._mapctrl.add(n);t.$___listJspanelElement&&t.$___listJspanelElement.$table.bootstrapTable("load",t.___displaydatas)}},remove:function(n){var t=-1;if(t=this.___datas.indexOf(n),t>=0&&this.___datas.splice(t,1),t=this.___displaydatas.indexOf(n),t>=0&&this.___displaydatas.splice(t,1),!this._mapctrl.remove){alert("this._mapctrl尚未實作add");return}this._mapctrl.remove(n);this.$___listJspanelElement&&this.$___listJspanelElement.$table.bootstrapTable("load",this.___displaydatas)},setOpacity:function(n){this._mapctrl.setOpacity(n)},repaintLegendUI:function(t){var i=this,r=n(".legend",this.$element);if(r.length==0&&(this.$element.append('<div class="legend">'),r=n(".legend",this.$element)),r.empty(),t&&(this.settings.legendIcons=t),this.settings.legendIcons&&(n.each(this.settings.legendIcons,function(t,u){var f;i.settings.type==n.BasePinCtrl.type.point?r.append('<span class="legend-icon"><img src="'+u.url+'">'+u.name+"<\/span>"):i.settings.type==n.BasePinCtrl.type.polygon?(f=n('<span class="legend-icon"><div><\/div><span class="legend-name">'+u.name+"<\/span><\/span>").appendTo(r).find("> div").css("display","inline-flex").css("vertical-align","sub"),n('<svg width="26px" height="14px"><g><path><\/path><\/g><\/svg>').appendTo(f).find("path").attr("stroke",this.strokeColor).attr("stroke-opacity",this.strokeOpacity).attr("stroke-width",this.strokeWeight).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke-dasharray","0").attr("fill",this.fillColor).attr("fill-opacity",this.fillOpacity).attr("d","M0 7 L7 2 L10 0 L23 0 L26 3 L26 11 L23 14 L3 14 L0 14 Z")):i.settings.type==n.BasePinCtrl.type.polyline&&(f=n('<span class="legend-icon"><div><\/div><span class="legend-name">'+u.name+"<\/span><\/span>").appendTo(r).find("> div").css("display","inline-flex").css("vertical-align","sub"),n('<svg width="26px" height="14px"><g><path><\/path><\/g><\/svg>').appendTo(f).find("path").attr("stroke",this.strokeColor).attr("stroke-opacity",1).attr("stroke-width",3).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke-dasharray","0").attr("fill","none").attr("d","M0 4L9 11L18 4L26 11"))}),this.settings.legendIcons.length>1&&this.settings.enabledStatusFilter))r.find(".legend-icon").addClass("legend-enabled-control").off("click").on("click",function(){n(this).toggleClass("legend-disable");i.enabledStatusFilterSetDataTime&&clearTimeout(i.enabledStatusFilterSetDataTime);i.enabledStatusFilterSetDataTime=setTimeout(function(){i.___datas&&i.setData(i.___datas)},10)})},___setLocalCache:function(t){n.localCache.set(this.settings.name+"_list",n.extend(n.localCache.get(this.settings.name+"_list"),t))},___getLocalCache:function(){return n.localCache.get(this.settings.name+"_list")},___repaint:function(){var t,i;this._mapctrl&&(t=this,this._mapctrl.reDraw(t.___displaydatas),t.visible?t.show():t.hide(),this.isShowLabel&&t._mapctrl.showLabel(t.isShowLabel()),t.$___listJspanelElement?(i=function(){t.$___listJspanelElement.$table?(t.$___listJspanelElement.$table.bootstrapTable("load",t.___displaydatas),t.$element.trigger(n.BasePinCtrl.eventKeys.repaintPinCompleted,[t.___displaydatas])):setTimeout(i,100)},i()):t.$element.trigger(n.BasePinCtrl.eventKeys.repaintPinCompleted,[t.___displaydatas]),t.$element.hide_busyIndicator(!0))},___resizeTable:function(){var t=this;t.$___listJspanelElement.$table&&setTimeout(function(){var i=n(".fixed-table-toolbar .search.active",t.$___listJspanelElement);t.$___listJspanelElement.$table.bootstrapTable("resetView",{height:n(".jsPanel-content",t.$___listJspanelElement).height()-(i.length>0?4:0)});console.log('search.is(":visible"):'+i.is(":visible"));setTimeout(function(){n(".fixed-table-header",t.$___listJspanelElement.$listBootstrapTable).css("border-bottom-color","").css("border-bottom-width","")})})},___listenTableMouseEvent:function(){var i,t=this;n("tbody tr",this.$___listJspanelElement.$table).off("mouseover").on("mouseover",function(){if(t.__triggerMouseEventForListTable){var r=n(this).attr("data-index");t._mapctrl.offFocusGraphic(i,!0);i=t._mapctrl.getGraphicByRindex(r);t._mapctrl.onFocusGraphic(i,!0)}}).off("mouseleave").on("mouseleave",function(){var i=n(this).attr("data-index");t._mapctrl.offFocusGraphic(t._mapctrl.getGraphicByRindex(i),!0)});n("tbody",this.$___listJspanelElement.$table).off("mouseleave").on("mouseleave",function(){t.__triggerMouseEventForListTable&&t._mapctrl.offFocusGraphic(i,!0)});t.$___meterListCount.html(this.___displaydatas.length)},___scrollContenTop:function(t){n(".fixed-table-body",this.$___listJspanelElement.$listBootstrapTable)[0].scrollTop=t},___filterItemText:function(n,t){var r,i;if(t){r=t.toLowerCase();for(i in n)if((typeof n[i]=="string"||typeof n[i]=="number")&&(n[i]+"").toLowerCase().indexOf(r)!==-1)return!0;return!1}return!0},show:function(){var i=this.settings.map.getZoom(),t=this.$__pinswitch.is(":disabled");this._mapctrl.show(!t);this.$element.trigger(n.BasePinCtrl.eventKeys.pinShowChange,[!0])},hide:function(){this._mapctrl.show(!1);this.$__pinlabel&&(this.$__pinlabel.prop("checked",!1),this.$__pinlabel.trigger("change"));this.$__pinlist&&(this.$__pinlist.prop("checked",!1),this.$__pinlist.trigger("change"));this.$element.trigger(n.BasePinCtrl.eventKeys.pinShowChange,[!1])},isShowLabel:function(){return this.$__pinlabel?this.$__pinlabel.is(":checked"):!1}};n.fn[t]=function(r){var f,u;if(this.data(t)instanceof i||this.data(t,new i(this[0])),u=this.data(t),typeof r=="undefined"||typeof r=="object")return typeof u.init=="function"&&u.init(r),this.instance=u,this;if(typeof r=="string"&&typeof u[r]=="function")return f=Array.prototype.slice.call(arguments,1),u[r].apply(u,f);n.error("Method "+r+" does not exist on jQuery."+t)}}(jQuery);