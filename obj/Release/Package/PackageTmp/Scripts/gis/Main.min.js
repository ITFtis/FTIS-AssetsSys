(function(n){"use strict";var t="temp__",i=function(t,i){i&&(i.stopPropagation(),i.preventDefault());this.$element=n(t);this.settings={}};i.prototype={constructor:i,init:function(i){n.extend(this.settings,i);console.log(t+" init")}};n.fn[t]=function(r){this.each(function(){var f,u=n(this).data(t);if(u||(n(this).data(t,new i(this)),u=n(this).data(t)),typeof r=="undefined"||typeof r=="object")typeof u.init=="function"&&u.init(r);else{if(typeof r=="string"&&typeof u[r]=="function")return f=Array.prototype.slice.call(arguments,1),u[r].apply(u,f);n.error("Method "+r+" does not exist on jQuery."+t)}})}})(jQuery);var whatMap=function(n){return n==undefined&&alert("map is null at whatMap"),n.overlayMapTypes?"google":n.hasOwnProperty("_leaflet_id")?"leaflet":n.hasOwnProperty("dragRotate")?"golife":"arcgis"};(function(n){"use strict";function u(n){var t=document.getElementsByTagName("script"),i;if(t&&t.length>0)for(i in t){if(t[i].src&&t[i].src.match(new RegExp(n+"\\.js$")))return t[i].src.replace(new RegExp("(.*)"+n+"\\.js$"),"$1");if(t[i].src&&t[i].src.match(new RegExp(n+".min\\.js$")))return t[i].src.replace(new RegExp("(.*)"+n+".min\\.js$"),"$1")}}var r=function(t,i){var u,r;if(t)for(u=0,r=0;r<t.length;r++)n.getScript(t[r],function(){u++;t.length==u&&i()})},t,i,f;n.AppConfigOptions=n.extend({script:{},default_loading_icon:undefined},n.AppConfigOptions,!0);n.AppConfigOptions.script.gispath||(n.AppConfigOptions.script.gispath=u("gis/Main")+"gis");n.AppConfigOptions.default_loading||(n.AppConfigOptions.default_loading={icon:n.AppConfigOptions.script.gispath+"/images/loading/loading_black.gif",size:"0.9em"});n.AppConfigOptions.def={};n.AppConfigOptions.def.typh={name:"typh",js:"/ext/typh/Typh.js"};n.AppConfigOptions.def.cloud={name:"cloud",js:"/ext/cloud/Cloud.js"};n.AppConfigOptions.def.drawtool={name:"gisdrawtool",js:"/ext/draw/Drawtool.js"};n.AppConfigOptions.def.mapBaseLayer={name:"MapBaseLayer",js:"/ext/baselayer/MapBaseLayer.js"};n.AppConfigOptions.def.coordinateInfo={name:"CoordinateInfo",js:"/ext/info/CoordinateInfo.js"};n.AppConfigOptions.def.export={name:"ExportMap",js:"/ext/export/ExportMap.js"};n.AppConfigOptions.def.basepinctrl={name:"BasePinCtrl",js:"/ext/meter/BasePinCtrl.js"};n.AppConfigOptions.def.pinctrl={name:"PinCtrl",js:"/ext/meter/PinCtrl.js"};n.AppConfigOptions.def.polygonctrl={name:"PolygonCtrl",js:"/ext/meter/PolygonCtrl.js"};n.AppConfigOptions.def.polylinectrl={name:"PolylineCtrl",js:"/ext/meter/PolylineCtrl.js"};n.AppConfigOptions.def.kmlctrl={name:"KmlCtrl",js:"/ext/meter/KmlCtrl.js"};n.AppConfigOptions.def.waterctrl={name:"WaterCtrl",js:"/ext/meter/WaterCtrl.js"};n.AppConfigOptions.def.rainctrl={name:"RainCtrl",js:"/ext/meter/RainCtrl.js"};n.AppConfigOptions.def.cctvctrl={name:"CctvCtrl",js:"/ext/meter/CctvCtrl.js"};n.AppConfigOptions.def.boundary={name:"Boundary",js:"/ext/boundary/Boundary.js"};n.AppConfigOptions.def.boundaryMap={name:"BoundaryMap",js:"/ext/boundary/BoundaryMap.js"};n.AppConfigOptions.def.boundaryLayer={name:"BoundaryLayer",js:"/ext/boundary/BoundaryLayer.js"};n.AppConfigOptions.def.boundaryFeatureLayer={name:"BoundaryFeatureLayer",js:"/ext/arcgis/BoundaryFeatureLayer.js"};n.AppConfigOptions.def.localKml={name:"LocalKml",js:"/ext/kml/LocalKml.js"};n.AppConfigOptions.def.basePosition={name:"BasePosition",js:"/ext/position/BasePosition.js"};n.AppConfigOptions.def.districtPosition={name:"DistrictPosition",js:"/ext/position/DistrictPosition.js"};n.AppConfigOptions.def.addressGeocode={name:"addressGeocode",js:"/ext/geocode/AddressGeocode.js"};n.AppConfigOptions.require={};n.AppConfigOptions.require.request=function(t,i){var u=[],e=function(){u.length>0?r(u,i):i()},f;n.each(t,function(){this!==undefined&&(n.fn[this.name]||(this.js===n.AppConfigOptions.def.basepinctrl.js?f=n.AppConfigOptions.script.gispath+this.js:u.push(n.AppConfigOptions.script.gispath+this.js)))});n.fn.jsPanel||u.push(n.AppConfigOptions.script.gispath+"/jspanel/jquery.jspanel-1.10.0.js");window.helper&&window.helper.loaded||u.push(n.AppConfigOptions.script.gispath+"/helper.js");window.xmlToJSON||u.push(n.AppConfigOptions.script.gispath+"/other/xmlToJSON.js");f?r([f],e):e()};n.AppConfigOptions.require.all=function(t){n.AppConfigOptions.def.all=[];for(var i in n.AppConfigOptions.def)if(i!=="all"){if(i=="boundary"&&window.boundary&&window.boundary.PolygonBoundary)continue;n.AppConfigOptions.def.all.push(n.AppConfigOptions.def[i])}n.AppConfigOptions.require.request(n.AppConfigOptions.def.all,t)};n.MapBaseLayerDefaultSettings={layerid:"basemaplayer",tiles:{MAP_TYPE_ROADMAP:{id:"google_roadmap",name:"街圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}.googleapis.com/vt?lyrs=m@262000000&src=apiv3&hl=zh-TW&x=${col}&y=${row}&z=${level}&style=47,37%7Csmartmaps",options:{subDomains:["mt0","mt1","mt2","mt3"]}},MAP_TYPE_SATELLITE_HYBRID:{id:"google_hybrid",name:"衛星",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}.google.com/vt/lyrs=y&hl=zh-TW&x=${col}&y=${row}&z=${level}&s=Galile",options:{subDomains:["mt0","mt1","mt2","mt3"]}},MAP_TYPE_PHYSICAL_HYBRID:{id:"google_terrain",name:"地形",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}.google.com.tw/vt/lbw/lyrs=p&hl=zh-TW&x=${col}&y=${row}&z=${level}&s=Gali",options:{subDomains:["khm0","khm1","khm2","khm3"]}}},ext:{TGOS:{"通用版電子地圖":{id:"tgos",name:"通用版電子地圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=NLSCMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"TGOS電子地圖":{id:"TGOSMAP_W",name:"TGOS電子地圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=TGOSMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"福衛二號混合圖":{id:"ROADMAP_W",name:"福衛二號混合圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=ROADMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"福衛二號影像":{id:"F2IMAGE_W",name:"福衛二號影像",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=F2IMAGE_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"地形暈渲混合圖":{id:"HILLSHADE_W",name:"地形暈渲混合圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=HILLSHADEMIX_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"地形暈渲圖":{id:"HILLSHADE_W",name:"地形暈渲圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=HILLSHADE_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"路網數值圖":{id:"MOTCMAP_W",name:"路網數值圖",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}gis.sinica.edu.tw/tgos/file-exists.php?img=MOTCMAP_W-png-${level}-${col}-${row}",options:{subDomains:["","",""]}},"航照影像":{id:"PHOTO2",name:"航照影像",type:"WebTiledLayer",url:document.location.protocol+"//${subDomain}wmts.nlsc.gov.tw/wmts/PHOTO2/default/GoogleMapsCompatible/${level}/${row}/${col}",options:{subDomains:["","",""]}}},Google:{silver:{id:"sliver-street",name:"銀白",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276236!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZmY1ZjVmNSxzLmU6bC5pfHAudjpvZmYscy5lOmwudC5mfHAuYzojZmY2MTYxNjEscy5lOmwudC5zfHAuYzojZmZmNWY1ZjUscy50OjIxfHMuZTpsLnQuZnxwLmM6I2ZmYmRiZGJkLHMudDoyfHMuZTpnfHAuYzojZmZlZWVlZWUscy50OjJ8cy5lOmwudC5mfHAuYzojZmY3NTc1NzUscy50OjQwfHMuZTpnfHAuYzojZmZlNWU1ZTUscy50OjQwfHMuZTpsLnQuZnxwLmM6I2ZmOWU5ZTllLHMudDozfHMuZTpnfHAuYzojZmZmZmZmZmYscy50OjUwfHMuZTpsLnQuZnxwLmM6I2ZmNzU3NTc1LHMudDo0OXxzLmU6Z3xwLmM6I2ZmZGFkYWRhLHMudDo0OXxzLmU6bC50LmZ8cC5jOiNmZjYxNjE2MSxzLnQ6NTF8cy5lOmwudC5mfHAuYzojZmY5ZTllOWUscy50OjY1fHMuZTpnfHAuYzojZmZlNWU1ZTUscy50OjY2fHMuZTpnfHAuYzojZmZlZWVlZWUscy50OjZ8cy5lOmd8cC5jOiNmZmM5YzljOSxzLnQ6NnxzLmU6bC50LmZ8cC5jOiNmZjllOWU5ZQ!4e0!5m1!5f2",options:{subDomains:["","","",""]}},gray:{id:"ggray-street",name:"灰階",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i432136532!3m14!2szh-TW!3sUS!5e18!12m1!1e68!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2sp.s%3A-100!4e0!23i1301875",options:{subDomains:["","","",""]}},retro:{id:"retro-street",name:"復古",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276248!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZmViZTNjZCxzLmU6bC50LmZ8cC5jOiNmZjUyMzczNSxzLmU6bC50LnN8cC5jOiNmZmY1ZjFlNixzLnQ6MXxzLmU6Zy5zfHAuYzojZmZjOWIyYTYscy50OjIxfHMuZTpnLnN8cC5jOiNmZmRjZDJiZSxzLnQ6MjF8cy5lOmwudC5mfHAuYzojZmZhZTllOTAscy50OjgyfHMuZTpnfHAuYzojZmZkZmQyYWUscy50OjJ8cy5lOmd8cC5jOiNmZmRmZDJhZSxzLnQ6MnxzLmU6bC50LmZ8cC5jOiNmZjkzODE3YyxzLnQ6NDB8cy5lOmcuZnxwLmM6I2ZmYTViMDc2LHMudDo0MHxzLmU6bC50LmZ8cC5jOiNmZjQ0NzUzMCxzLnQ6M3xzLmU6Z3xwLmM6I2ZmZjVmMWU2LHMudDo1MHxzLmU6Z3xwLmM6I2ZmZmRmY2Y4LHMudDo0OXxzLmU6Z3xwLmM6I2ZmZjhjOTY3LHMudDo0OXxzLmU6Zy5zfHAuYzojZmZlOWJjNjIscy50Ojc4NXxzLmU6Z3xwLmM6I2ZmZTk4ZDU4LHMudDo3ODV8cy5lOmcuc3xwLmM6I2ZmZGI4NTU1LHMudDo1MXxzLmU6bC50LmZ8cC5jOiNmZjgwNmI2MyxzLnQ6NjV8cy5lOmd8cC5jOiNmZmRmZDJhZSxzLnQ6NjV8cy5lOmwudC5mfHAuYzojZmY4ZjdkNzcscy50OjY1fHMuZTpsLnQuc3xwLmM6I2ZmZWJlM2NkLHMudDo2NnxzLmU6Z3xwLmM6I2ZmZGZkMmFlLHMudDo2fHMuZTpnLmZ8cC5jOiNmZmI5ZDNjMixzLnQ6NnxzLmU6bC50LmZ8cC5jOiNmZjkyOTk4ZA!4e0!5m1!5f2",options:{subDomains:["","","",""]}},dark:{id:"gdark-street",name:"黑階",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i480190100!3m14!2szh-TW!3sUS!5e18!12m1!1e68!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZjI0MmYzZSxzLmU6bC50LnN8cC5jOiNmZjI0MmYzZSxzLmU6bC50LmZ8cC5jOiNmZjc0Njg1NSxzLnQ6MTl8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjJ8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjQwfHMuZTpnfHAuYzojZmYyNjNjM2Yscy50OjQwfHMuZTpsLnQuZnxwLmM6I2ZmNmI5YTc2LHMudDozfHMuZTpnfHAuYzojZmYzODQxNGUscy50OjN8cy5lOmcuc3xwLmM6I2ZmMjEyYTM3LHMudDozfHMuZTpsLnQuZnxwLmM6I2ZmOWNhNWIzLHMudDo0OXxzLmU6Z3xwLmM6I2ZmNzQ2ODU1LHMudDo0OXxzLmU6Zy5zfHAuYzojZmYxZjI4MzUscy50OjQ5fHMuZTpsLnQuZnxwLmM6I2ZmZjNkMTljLHMudDo0fHMuZTpnfHAuYzojZmYyZjM5NDgscy50OjY2fHMuZTpsLnQuZnxwLmM6I2ZmZDU5NTYzLHMudDo2fHMuZTpnfHAuYzojZmYxNzI2M2Mscy50OjZ8cy5lOmwudC5mfHAuYzojZmY1MTVjNmQscy50OjZ8cy5lOmwudC5zfHAuYzojZmYxNzI2M2M!4e0!5m1!5f2",options:{subDomains:["","","",""]}},night_mode:{id:"night-mode-street",name:"夜晚",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276212!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy5lOmd8cC5jOiNmZjI0MmYzZSxzLmU6bC50LnN8cC5jOiNmZjI0MmYzZSxzLmU6bC50LmZ8cC5jOiNmZjc0Njg1NSxzLnQ6MTl8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjJ8cy5lOmwudC5mfHAuYzojZmZkNTk1NjMscy50OjQwfHMuZTpnfHAuYzojZmYyNjNjM2Yscy50OjQwfHMuZTpsLnQuZnxwLmM6I2ZmNmI5YTc2LHMudDozfHMuZTpnfHAuYzojZmYzODQxNGUscy50OjN8cy5lOmcuc3xwLmM6I2ZmMjEyYTM3LHMudDozfHMuZTpsLnQuZnxwLmM6I2ZmOWNhNWIzLHMudDo0OXxzLmU6Z3xwLmM6I2ZmNzQ2ODU1LHMudDo0OXxzLmU6Zy5zfHAuYzojZmYxZjI4MzUscy50OjQ5fHMuZTpsLnQuZnxwLmM6I2ZmZjNkMTljLHMudDo0fHMuZTpnfHAuYzojZmYyZjM5NDgscy50OjY2fHMuZTpsLnQuZnxwLmM6I2ZmZDU5NTYzLHMudDo2fHMuZTpnfHAuYzojZmYxNzI2M2Mscy50OjZ8cy5lOmwudC5mfHAuYzojZmY1MTVjNmQscy50OjZ8cy5lOmwudC5zfHAuYzojZmYxNzI2M2M!4e0!5m1!5f2",options:{subDomains:["","","",""]}},hide_featires:{id:"hide-featires-street",name:"精簡街景",type:"WebTiledLayer",url:document.location.protocol+"//maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i${level}!2i${col}!3i${row}!4i256!2m3!1e0!2sm!3i553276236!3m17!2szh-TW!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHAudjpvZmYscy50OjR8cy5lOmwuaXxwLnY6b2Zm!4e0!5m1!5f2",options:{subDomains:["","","",""]}},g3d:{id:"g3d",name:"3D",type:"WebTiledLayer",url:"https://${subDomain}.googleapis.com/kh?v=134&hl=zh-TW&deg=0&x=${col}&y=${row}&z=${level}",options:{subDomains:["khms0"]}}}},defaultSettings:{map:null,ctrlMode:"radio",defaultLayer:"街圖",initEvent:null}};n.menuctrl={eventKeys:{popu_init_before:"popu-init-event-before",popu_init_after:"popu-init-event-after",ctrl_show_change:"showchange",init_ctrl_menu_completed:"init-menu-init_ctrl_menu_completed"}};n.checkFunctionMenu=function(t,i){if(i&&i!="*"){var r=n(t+" [data-function-id]");n.each(r,function(){var t=n(this),r=t.attr("data-function-id");t.addClass("none-auth-function");n.each(i,function(){if(r==this.Id)return t.removeClass("none-auth-function"),!1})});n(t+" .none-auth-function").remove();n.each(n(t+" ul:not(:has(*))"),function(){n(this).parent("li").length>0&&n(this).parent("li").remove()})}};n.initGisMenu=function(n){window.helper?t(n):loadRequestScript(function(){t(n)})};t=function(t){var r=n(".popu-ctrl-container"),y=0,i=t.indexOf(".")===0?n(t):n("#"+t),e=i.outerHeight?i.outerHeight():i.height(),a,p,w,b,s,h,v,c,u;n.each(n(".popu-ctrl-menu"),function(){r.find(n(this).attr("href")).addClass("popu-ctrl-content")});a=function(){var t=n(".tools-group-ctrl",i);n.each(t,function(){var i=n(this).removeClass("dropdown-toggle"),r,t;i.find(".caret:first").remove();r=n(".popu-ctrl-container");t=n("+ul",i);t.addClass("tools-group-panel");t.removeClass("dropdown-menu");t.appendTo(r);t.attr("id")||t.attr("id","id"+helper.misc.geguid().replace(/-/g,""));i.attr("href","#"+t.attr("id")).addClass("posit-ctrl-menu");n.each(n(">li>a",t),function(){var t=n(this);t.addClass("tools-member-ctrl");t.attr("title",t.html());t.html("");n('<span class="glyphicon '+t.attr("data-glyphicon")+'"><\/span>').appendTo(t)})})};a();p=n(".popu-ctrl-menu").on("click",function(t){var s=n(this),u,l,a,r,v;if(t.preventDefault(),n(".navbar-collapse",i).removeClass("in").addClass("collapse"),i.find(".collapse.show").removeClass("show"),u=n(n(this).attr("href")),u.show(),t.clientX&&f(s,{clientX:t.clientX,clientY:t.clientY}),u.length>0&&n(this).attr("popu-target")==undefined){u.show();u.trigger(n.menuctrl.eventKeys.popu_init_before);l=(new Date).getTime();u.css("min-height","100%");a=s.attr("data-theme")?s.attr("data-theme"):"gdark";r=n(".popu-ctrl-container").jsPanel({id:l+"",classes:s.hasClass("tools-member-ctrl")?"jsPanel-window":"",title:this.innerHTML+(n(this).hasClass("tools-member-ctrl")?" "+n(this).attr("title"):""),theme:a,contentBG:{padding:"0 3px 3px 3px"},size:{width:"",height:"auto"},overflow:"auto",draggable:{stop:function(t){n(t.target).css("opacity","")},handle:".jsPanel-hdr-l"},position:n.isSupportLocalStorage()?{top:t.clientY,left:t.clientX}:{top:e,left:o()?n(".popu-ctrl-container .jsPanel").length*15:""},controls:{buttons:"all",iconfont:"bootstrap"},content:u}).addClass("popu-ctrl").on("onjspanelloaded",function(){r.position().left<0&&r.css("left",0);r.position().top<0&&r.css("top",0)});u.attr("id")&&r.addClass("jsPanel-"+u.attr("id"));r.on("resizestop",function(){f(s,{width:r.width(),height:r.height()})});r.on("dragstop",function(){f(s,{top:r.position().top,left:r.position().left})});n(this).attr("data-default-width")&&r.attr("data-width",n(this).attr("data-default-width"));n(this).attr("data-default-height")&&r.attr("data-height",n(this).attr("data-default-height"));n(this).attr("data-default-top")&&r.attr("data-top",n(this).attr("data-default-top")+"px");n(this).attr("data-default-left")&&r.attr("data-left",n(this).attr("data-default-left")+"px");n(this).attr("popu-target",l);n(".jsPanel-content",r).css("padding","0 2px 2px 2px");n(".jsPanel-hdr-r .jsPanel-hdr-r-btn-close",r).unbind("click").on("click",function(){h(s,r)});n(".jsPanel-hdr-r-btn-max",r).hide();n(".jsPanel-hdr-r-btn-min",r).hide();n(".jsPanel-hdr-r-btn-max",r).on("click",function(){n(".jsPanel-hdr-r-btn-max",r).hide();n(".jsPanel-hdr-r-btn-min",r).show();n(".jsPanel-hdr-r .jsPanel-hdr-r-btn-close",r).show()});r.mouseenter(function(){r.front()});c();u.trigger(n.menuctrl.eventKeys.popu_init_after);r.hide()}y++;v=n("#"+n(this).attr("popu-target"));h(s,v)}).on("setActive",function(t,i){var r=n(t.target);i&&!r.hasClass("selected")?r.trigger("click"):!i&&r.hasClass("selected")&&r.trigger("click")});w=n(".posit-ctrl-menu").on("click",function(t){var u=n(this),o=u.attr("data-cache-show"),r,e;t.preventDefault();n(".navbar-collapse",i).removeClass("in").addClass("collapse");i.find(".collapse.show").removeClass("show");r=n(n(this).attr("href"));r.length>0&&n(this).attr("popu-target")==undefined&&(r.trigger(n.menuctrl.eventKeys.popu_init_before),r.hide(),n(this).attr("popu-target",(new Date).getTime()),r.trigger(n.menuctrl.eventKeys.popu_init_after));e=r.attr("data-display-direction");o!="false"&&f(u,{show:!r.is(":visible")});"up-down"===e?r.is(":hidden")?r.slideDown(500):r.slideUp(500):r.toggle("slide",{direction:e?e:"left",easing:"easeInOutBack"},500);r.mouseenter(function(){var t=0;n(".jsPanel").each(function(){n(this).zIndex()>t&&(t=n(this).zIndex())});r.css("z-index",t+1)});u.toggleClass("selected");u.trigger(n.menuctrl.eventKeys.ctrl_show_change,u.hasClass("selected"))}).on("setActive",function(t,i){var r=n(t.target);i&&!r.hasClass("selected")?r.trigger("click"):!i&&r.hasClass("selected")&&r.trigger("click")});n('<div class="close-mainmenu"><span title="隱藏" class=" glyphicon glyphicon-export"><\/span><\/div>').prependTo(n(".navbar-collapse",i));b=n(".glyphicon.glyphicon-export",i);n(".close-mainmenu",i).on("click",function(){i.toggle("slide",{direction:"top",easing:"easeInOutCubic"},500)});i.after('<div style="right:0px;position: absolute;top:0;z-index:'+((i.css("z-index")=="auto"?950:i.css("z-index"))-1)+';"><button  class=" show-mainmenu" ><span title="功能選單" class="glyphicon glyphicon-align-justify"><\/span><\/button><\/div>');n(".show-mainmenu").on("click",function(){i.toggle("slide",{direction:"top",easing:"easeInOutBack"},500)});n(window).resize(function(){c()});s=0;h=function(t,r){var y,u;t.toggleClass("selected");var h=t.hasClass("selected"),c=t.attr("data-cache-show"),a=o(),v=a?"switch":"popu-slide";r.show().addClass(v);a&&n.isSupportLocalStorage()&&(r.parents("#jsPanel-min-container").length==0?(y=r.position(),u=l(t),h?(u&&u.top?r.css("top",u.top+"px"):r.css("top",(i.is(":visible")?e:10)+"px"),u&&u.left?r.css("left",u.left+"px"):r.css("left",s++*40+"px")):(u&&u.clientY&&r.css("top",u.clientY+"px"),u&&u.clientX&&r.css("left",u.clientX+"px"))):n(".jsPanel-hdr-r-btn-max",r).trigger("click"));setTimeout(function(){r.toggleClass("selected");r.one("transitionend oTransitionEnd otransitionend MSTransitionEnd",function(){setTimeout(function(){r.removeClass(v);t.hasClass("selected")||r.hide()})});c!="false"&&f(t,{show:h});t.trigger(n.menuctrl.eventKeys.ctrl_show_change,h)});return};n(".posit-ctrl-menu,.popu-ctrl-menu").on(n.menuctrl.eventKeys.ctrl_show_change,function(n,t){v.call(this,n,t)});v=function(t,r){var u=n(this),f,e;if(u.attr("trigger-show-group-form-other")){setTimeout(function(){u.removeAttr("trigger-show-group-form-other")});return}f=u.attr("data-show-group-all");f&&i.find('[data-show-group-all="'+f+'"]:not([href="'+u.attr("href")+'"])').attr("trigger-show-group-form-other",!0).trigger("setActive",[r]);e=u.attr("data-show-group-single");e&&i.find('.selected[data-show-group-single="'+e+'"]:not([href="'+u.attr("href")+'"])').attr("trigger-show-group-form-other",!0).trigger("setActive",[!1])};c=function(){var t=n(".popu-ctrl-container .popu-ctrl"),i;t.length>0&&(o()?n.each(t,function(t,i){var r=n(i),u,f;r.css("position","absolute");r.attr("data-width")&&(r.css("width",n(i).attr("data-width")),n(i).attr("data-width",""));r.attr("data-height")&&(r.css("height",n(i).attr("data-height")),n(i).attr("data-height",""));r.attr("data-top")!==undefined&&(u=n(i).attr("data-top").replace("px",""),f=n(i).attr("data-left").replace("px",""),window.outerHeight-u<70&&(u=window.outerHeight-70),window.outerWidth-f<200&&(f=window.outerWidth-200),n(i).attr("data-top",""),n(i).attr("data-left",""),r.css("top",u+"px"),r.css("left",f+"px"));n("").draggable&&r.hasClass("horizontal-drag-remove")&&r.draggable("option","axis",!1).off("dragstop").removeClass("horizontal-drag-remove")}):(i=e,n.each(t,function(t,r){var u=n(r),f;if(u.css("position")!="relative"){u.attr("data-top",n(r).css("top"));u.attr("data-left",n(r).css("left"));(u.attr("style")+"").indexOf("width:")>=0&&(u.attr("data-width",n(r).css("width")),u.css("width","auto"));u.css("top",i);u.css("left","0px");u.css("position","relative");n("").draggable&&u.draggable("option","axis","x");u.addClass("horizontal-drag-remove");u.off("dragstart").on("dragstart",function(){f=Date.now()}).off("dragstop").on("dragstop",function(){var n=u.width(),t=u.position().left,i=Date.now()-f;Math.abs(t/n)>(i<360?.1:.25)?(u.find(".jsPanel-hdr > .jsPanel-hdr-r > .jsPanel-hdr-r-btn-close").trigger("click"),setTimeout(function(){u.css("left","0px")},400)):u.css("left","0px")})}})))};try{u={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return u.Android()||u.BlackBerry()||u.iOS()||u.Opera()||u.Windows()}}}catch(g){}var o=function(){return n(".navbar-header .navbar-toggle,.navbar-toggler",i).is(":hidden")&&(u?!u.any():!1)},nt=function(){n(this).hasClass("minimized")&&(n(this).css("display","block"),n(".jsPanel-hdr-r-btn-max",n(this)).trigger("click"));n(".jsPanel-hdr-r-btn-max",n(this)).hide();k()},k=function(){var i=[],t,r;for(n.each(n(".jsPanel.minimized"),function(t,r){n(r).css("display")!=="none"&&i.push(r)}),t=0;t<i.length;t++)r=t*150+"px",n(i[t]).animate({left:r})},f=function(t,i){n.localCache.set(t.text()?t.text():t.attr("title"),n.extend(n.localCache.get(t),i))},l=function(t){return n.localCache.get(t.text()?t.text():t.attr("title"))},d=function(){function u(n){function s(i){clearTimeout(e);t.style.maxWidth!="none"&&(t.style.maxWidth="none");e=setTimeout(function(){var u=i.pageX-t.getBoundingClientRect().left+r;t.style.setProperty("width",u+"px");t.style.setProperty("--adj-width",-(u-r)+"px");clearTimeout(o);o=setTimeout(function(){n.hasClass("jsPanel")&&n.trigger("resizestop");n.find(".jsPanel").trigger("resizestop")},100)},20)}function h(){window.removeEventListener("mousemove",s)}for(var f,e,o,r=n.hasClass("jsPanel")?30:0,t=n[0],u=n.find(".resizer"),i=0;i<u.length;i++)f=u[i],f.addEventListener("mousedown",function(n){(n.button==undefined||n.button!=2)&&(n.preventDefault(),window.addEventListener("mousemove",s),window.addEventListener("mouseup",h))})}if(r.hasClass("fixed-at-left")){var t=r.hasClass("fixed-single");i.find(".popu-ctrl-menu").each(function(){var i=n(this).on(n.menuctrl.eventKeys.ctrl_show_change,function(i,u){var f=n("#"+n(this).attr("popu-target"));t?u?f.addClass("fixed-show"):f.removeClass("fixed-show"):(f.prependTo(r),u&&r.animate({scrollTop:0},500),r.attr("data-fixed-count",r.find(".popu-ctrl.selected:not(.jsPanel-window)").length))});n(i.attr("href")).on(n.menuctrl.eventKeys.popu_init_after,function(){var e=n(this),f=e.parents(".popu-ctrl").addClass("fix-popu-ctrl-toleft"),o;n('<div class="jsPanel-hdr-r-btn-content"><span class="glyphicon glyphicon-play"><\/span><\/div>').appendTo(e.parents(".popu-ctrl").find(".jsPanel-hdr-r")).find(".glyphicon").on("click",function(){f.find(".jsPanel-content").toggleClass("offdisplay");n(this).parent().toggleClass("ctrl-content-display")});n('<div class="jsPanel-hdr-r-btn-modal"><span class="glyphicon glyphicon-modal-window"><\/span><\/div>').appendTo(e.parents(".popu-ctrl").find(".jsPanel-hdr-r")).find(".glyphicon").on("click",function(){n(this).toggleClass("glyphicon-modal-window");n(this).toggleClass("glyphicon-pushpin");f.toggleClass("jsPanel-window");f[0].style.left=r.width()+6+"px";f[0].style.top="55px";r.attr("data-fixed-count",r.find(".popu-ctrl.selected:not(.jsPanel-window)").length)});if(t){i.attr("data-show-group-single","fixed-left-single");n('<div class="jsPanel-hdr-r-btn-collapse"><span class="glyphicon glyphicon-chevron-right to-show"><\/span><span class="glyphicon glyphicon-chevron-left to-collapse"><\/span><\/div>').appendTo(e.parents(".popu-ctrl").find(".jsPanel-hdr-r")).on("click",function(){f.toggleClass("fixed-show");f.show()});o=getComputedStyle(f.find("> .jsPanel-hdr")[0]);(o.backgroundColor=="transparent"||o.backgroundColor=="rgba(0, 0, 0, 0)")&&(f.find("> .jsPanel-hdr")[0].style.backgroundColor="white");helper.misc.detect.isIE||(n('<div class="resizer"><div class="size-icon"><\/div><\/div>').appendTo(f),u(f))}f.width("");f.attr("data-width","")});t&&i.attr("data-show-group-single","fixed-left-single")});n(".posit-ctrl-menu").each(function(){var t=n(n(this).attr("href"));t.parent().hasClass("fixed-at-left")&&(t.css("position","fixed"),(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&t.css("overflow","hidden"))});t||(n('<div class="resizer"><div class="size-icon"><\/div><\/div>').appendTo(r),u(r))}};return setTimeout(function(){d();i.attr("data-ctrl-cache")==="true"&&n.each(n(".popu-ctrl-menu,.posit-ctrl-menu "),function(){var t=l(n(this)),i;if(t)for(i in t)t[i]!==undefined&&n(this).attr("data-default-"+i,t[i])});try{n(".popu-ctrl-menu[data-default-show=true],.posit-ctrl-menu[data-default-show=true]",i).trigger("setActive",[!0]).blur();n(".tools-group-panel .popu-ctrl-menu[data-default-show=true],.tools-group-panel .posit-ctrl-menu[data-default-show=true]").trigger("setActive",[!0]).blur()}catch(t){console.log(t)}i.trigger(n.menuctrl.eventKeys.init_ctrl_menu_completed)},800),this};n.kmlhelper=function(t){var i={autoPolygonIndextoLower:!0,onLoaded:undefined};n.extend(i,t);i.map!=undefined&&require(["esri/layers/KMLLayer"],function(r){var u=new r(encodeURI(t.kmlurl),{id:i.layerid});if(i.map.addLayer(u),i.autoPolygonIndextoLower===!0)n.setPolygonIndextoLower(i.map,u,i.onLoaded);else if(i.onLoaded)u.on("load",function(){if(i.onLoaded)i.onLoaded(u)})})};n.parserStringToObject=function(t,i,r){var u={};return t&&n.each(t.split(i),function(n,t){if(t&&t.trim()){var i=t.split(r);i.length!=0&&(u[i[0].trim()]=i.length==1?i[0].trim():i[1].trim())}}),u};i=0;n.setPolygonIndextoLower=function(t,r,u){require(["dojo/_base/connect","esri/symbols/SimpleMarkerSymbol"],function(f){var e=r.__proto__?r.__proto__.declaredClass:r.declaredClass,o,s,h;if(e==="esri.layers.KMLLayer"){r.on("load",function(i){var f=i.layer.getLayers(),e=0;n.each(f,function(i,o){n.setPolygonIndextoLower(t,o,function(){e++;e===f.length&&u&&u(r)})})});r.on("error",function(n){u(r,n,"error")})}else e==="esri.layers.FeatureLayer"?(o=n.parseJSON(r._json),o.featureSet.features.length>0?(s=Boolean(o.featureSet.features[0].attributes.visibility),s?h=f.connect(r,"onUpdate",function(){f.disconnect(h);r.graphics.length>0&&r.graphics[0].geometry.type==="polygon"&&(t.reorderLayer(r,i),i++);u&&u(r);console.log(r.id+">>onload>")}):u&&u(r)):u&&u(r)):e==="esri.layers.MapImageLayer"&&u&&u(r)})};n.loadKmllayer=function(t,i,r,u,f,e){var h=null,s=i,o;try{localStorage&&u&&(o=JSON.parse(localStorage.getItem(s)),o&&(o.version==f?h=o.data:(localStorage.removeItem(s),console.log(r+" reomve old localStorage ;old version:"+o.version+"  new version:"+f))));localStorage&&!u&&(localStorage.removeItem(s),console.log(r+" not use localStorage ;"))}catch(c){}h?(require(["esri/layers/FeatureLayer"],function(n){var i=new n(h,{id:r+"_0"});t.addLayer(i);e(i)}),console.log(r+" use localStorage ;version:"+f)):(n.kmlhelper({map:t,layerid:r,kmlurl:i,onLoaded:function(n){var t=n.getLayers()[0],i;if(!dojo.isAndroid&&!dojo.isIos&&localStorage&&u&&t.toJson)try{i=t.toJson();localStorage.setItem(s,JSON.stringify({version:f,"data-size":JSON.stringify(i).length,data:i}))}catch(r){console.log(r)}e(t)}}),console.log(r+" use kml"))};n.autoOrderLayer=function(n){var r=0,i=0,t=0,f=function(u){n.reorderLayer(u,r);r++;i++;t++},e=function(r){n.reorderLayer(r,i);i++;t++},o=function(i){n.reorderLayer(i,t);t++},u=function(n){"point|multipoint ".indexOf(n.graphics[0].geometry.type)>=0?o(n):"polyline".indexOf(n.graphics[0].geometry.type)>=0?e(n):"polygon|extent".indexOf(n.graphics[0].geometry.type)>=0&&f(n)};n.on("layer-add",function(n){if(n.layer.graphics)if(n.layer.graphics.length>0)u(n.layer);else var t=n.layer.on("graphic-add",function(){u(n.layer);t.remove()})})};n.fn.gis_layer_opacity_slider=function(t){function r(){i.setOpacity&&i.setOpacity(u.slider("value")/100);f&&i.map.getLayer(i.layerid).setOpacity(u.slider("value")/100)}var i={map:null,layerid:undefined,min:10,max:100,value:95},u=this,f=!1,e,o;return n.extend(i,t),i.map==null&&alert("map is null"),u.slider({range:"min",max:i.max,min:i.min,value:i.value,slide:r,change:r}),whatMap(i.map)==="arcgis"&&(e=i.map._layers[i.layerid],e?f=!0:o=i.map.on("layer-add",function(n){n.layer.id==i.layerid&&(f=!0,r())})),r(),this};f=function(){setTimeout(function(){},1)}})(jQuery),function(){for(var i=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();